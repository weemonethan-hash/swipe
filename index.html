<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scroll for Money üí∏</title>
    <style>
        html, body { margin: 0; height: 100%; overflow: hidden; font-family: Poppins, sans-serif; color: white; }
        body {
            background: linear-gradient(0deg, #ff66cc, #66ccff, #99ff66, #ff9966);
            background-size: 100% 1000%;
            transition: background-position .1s linear;
        }
        #world { position: absolute; width: 100%; height: 100%; transition: transform .1s linear; }
        #hud { position: fixed; top: 10px; left: 10px; background: rgba(20, 20, 20, .8); border: 2px solid #00ff88; border-radius: 12px; padding: 10px 15px; z-index: 1000; box-shadow: 0 0 15px #00ff88; }
        #money { font-size: 1.6em; color: #00ff88; text-shadow: 0 0 10px #00ff88; font-weight: bold; }
        #xpBar { height: 10px; width: 100%; background: rgba(255, 255, 255, .2); border-radius: 5px; margin-top: 4px; overflow: hidden; }
        #xpFill { height: 100%; width: 0%; background: linear-gradient(90deg, #00ff88, #00ccff); transition: width .2s; }
        button { display: block; margin-top: 6px; padding: 6px 12px; background: #00ff88; color: #111; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; transition: .2s; }
        button:hover { transform: scale(1.05); background: #00cc6a; }
        .money-block { position: absolute; font-size: 50px; border: 3px solid white; border-radius: 10px; padding: 5px 10px; cursor: pointer; transition: transform .2s; user-select: none; }
        .money-block:hover { transform: scale(1.2); }
        .float { position: absolute; color: #00ff88; font-weight: bold; pointer-events: none; animation: float 1s ease-out forwards; text-shadow: 0 0 10px #00ff88; }
        @keyframes float { to { transform: translateY(-50px); opacity: 0; } }
        #loginScreen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #111d; color: white; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 2000; }
        #loginScreen input { margin: 5px; padding: 6px; width: 200px; border-radius: 6px; border: none; }
    </style>
    <!-- Firebase -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDj5-jNLG4Ampuc56ygFA8kXScbuVFctBk",
            authDomain: "scroll-3f622.firebaseapp.com",
            projectId: "scroll-3f622",
            storageBucket: "scroll-3f622.firebasestorage.app",
            messagingSenderId: "1012742622451",
            appId: "1:1012742622451:web:e217b4a775975911d93b86"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        window.firebaseFns = { auth, db, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, doc, setDoc, getDoc, updateDoc };
    </script>
</head>
<body>

<div id="loginScreen">
    <h2>Login / Register</h2>
    <input type="email" id="email" placeholder="Email">
    <input type="password" id="password" placeholder="Password">
    <button id="loginBtn">Login</button>
    <button id="registerBtn">Register</button>
</div>

<div id="hud" style="display:none;">
    üí∞ <span id="money">0</span><br>
    ‚≠ê Level: <span id="level">1</span>
    <div id="xpBar"><div id="xpFill"></div></div>
    <div>‚¨ÜÔ∏è Scroll: <span id="scrollIncome">1</span></div>
    <div>üß± Block: <span id="blockValue">10</span></div>
    <button id="upB">Upgrade Block üíé (100)</button>
    <button id="upS">Upgrade Scroll üöÄ (150)</button>
    <button id="autoScrollBtn">üåÄ Auto Scroll: OFF</button>
    <button id="dailyBonusBtn">Claim Daily Bonus</button>
    <button id="resetBtn" style="margin-top:5px;">Reset Account</button>
    <h3>Leaderboard</h3>
    <div id="leaderboard"></div>
</div>

<div id="world"></div>
<audio id="ding" src="https://assets.mixkit.co/sfx/preview/mixkit-achievement-bell-600.mp3"></audio>

<script type="module">
    import { auth, db, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, doc, setDoc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-auth.js";
    import { doc as docRef, setDoc as setDocFn, getDoc as getDocFn, updateDoc as updateDocFn } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-firestore.js";

    const loginScreen = document.getElementById("loginScreen");
    const hud = document.getElementById("hud");
    const emailInput = document.getElementById("email");
    const passwordInput = document.getElementById("password");
    const leaderboardDiv = document.getElementById("leaderboard");
    let money = 0, blockScroll = 1, block = 10, level = 1, xp = 0;
    let upBC = 100, upSC = 150, worldY = 0, bgY = 0, auto = false;
    let currentBG = "bg1", currentBlock = "block1", eventData = null;

    const world = document.getElementById("world"), ding = document.getElementById("ding");
    const mD = document.getElementById("money"), lD = document.getElementById("level"),
    sD = document.getElementById("scrollIncome"), bD = document.getElementById("blockValue"), xpF = document.getElementById("xpFill");
    const autoBtn = document.getElementById("autoScrollBtn");

    function xpNeed() { return 100 * Math.pow(1.6, level - 1); }
    function upd() { mD.textContent = Math.floor(money); lD.textContent = level; sD.textContent = blockScroll; bD.textContent = block; xpF.style.width = (xp / xpNeed() * 100) + "%"; }
    function sound() { ding.currentTime = 0; ding.play().catch(() => {}); }
    function float(x, y, t, color = "#00ff88") { let f = document.createElement("div"); f.className = "float"; f.style.left = x + "px"; f.style.top = y + "px"; f.style.color = color; f.textContent = t; document.body.appendChild(f); setTimeout(() => f.remove(), 1000); }
    function addXP(a) { xp += a; if (xp >= xpNeed()) { xp -= xpNeed(); level++; sound(); } }

    function login(user) {
        if (!user) return;
        loginScreen.style.display = "none";
        hud.style.display = "block";
        getDoc(doc(db, "users", user.uid)).then((docSnap) => {
            if (docSnap.exists()) {
                let data = docSnap.data();
                money = data.money || 0;
                blockScroll = data.blockScroll || 1;
                block = data.block || 10;
                level = data.level || 1;
                xp = data.xp || 0;
                auto = data.auto || false;
                updateLeaderboard();
            } else {
                setDoc(doc(db, "users", user.uid), { money, blockScroll, block, level, xp, auto });
            }
            upd();
        });
    }

    onAuthStateChanged(auth, (user) => { if (user) login(user); });

    // Events handling
    function fetchEventData() {
        getDoc(doc(db, "events", "global")).then(docSnap => {
            if (docSnap.exists()) {
                eventData = docSnap.data();
                handleEvent(eventData);
            }
        });
    }

    function handleEvent(data) {
        if (data && data.type && new Date(data.endsAt) > new Date()) {
            console.log("Event active:", data);
            // Handle Event Logic (for example, apply multiplier)
            // Implement visual effect for events here
        }
    }

    setInterval(fetchEventData, 5000); // Keep fetching event data

    // Multiplayer leaderboard
    function updateLeaderboard() {
        getDoc(doc(db, "leaderboard", "top10")).then(docSnap => {
            if (docSnap.exists()) {
                const leaders = docSnap.data().top10;
                leaderboardDiv.innerHTML = "";
                leaders.forEach(leader => {
                    let div = document.createElement("div");
                    div.textContent = `${leader.name}: ${leader.money}`;
                    leaderboardDiv.appendChild(div);
                });
            }
        });
    }

    // Game mechanics
    setInterval(() => { money += blockScroll; addXP(0.1); upd(); }, 1000); // Auto money generation

    autoBtn.addEventListener("click", () => {
        auto = !auto;
        autoBtn.textContent = `üåÄ Auto Scroll: ${auto ? "ON" : "OFF"}`;
    });

    document.getElementById("loginBtn").addEventListener("click", () => {
        const email = emailInput.value, password = passwordInput.value;
        signInWithEmailAndPassword(auth, email, password).catch(console.log);
    });

    document.getElementById("registerBtn").addEventListener("click", () => {
        const email = emailInput.value, password = passwordInput.value;
        createUserWithEmailAndPassword(auth, email, password).catch(console.log);
    });
</script>

</body>
</html>
